<!DOCTYPE html>
<html>
<head>
    <title>Results</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 8px 12px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }

        tr:nth-child(even) {
            background-color: #fafafa;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

</head>
<body>

<h2>Search Results: {{ results|length }} programs found</h2>
<form action="{{ url_for('search') }}" method="get">
    <button type="submit">New Search</button>
</form>
<br><br>

<table>
    <thead>
        <tr>
            <th>Major</th>
            <th>Return on Investment (over 10 years)</th>
            <th>Estimated Cost of Attendance (1 year)</th>
            <th>College</th>
        </tr>
    </thead>
    <tbody>
        {% for row in results %}
        <tr>
            <td>{{ row[0] }}</td>
            <td>${{ "{:,}".format(row[1]) }}</td>
            <td>${{ "{:,}".format(row[2] or 0) }}</td>
            <td>{{ row[3] }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<h3>ROI Distribution by Institution</h3>
<canvas id="resultsChart" width="400" height="200"></canvas>

<h3>Sunburst Chart: Major Categories by Salary Range in {{ state }}</h3>
<div id="sunburstChart" style="width:100%;height:500px;"></div>

<script>
    // Bar chart
    const chartLabels = {{ chart_labels | tojson }};
    const chartValues = {{ chart_values | tojson }};
    const ctx = document.getElementById('resultsChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: chartLabels,
            datasets: [{
                label: 'Return on Investment ($)',
                data: chartValues,
                backgroundColor: 'rgba(54, 162, 235, 0.6)'
            }]
        },
        options: {
            responsive: true,
            scales: {
                x: { title: { display: true, text: 'Institution' }},
                y: { title: { display: true, text: 'ROI ($)' }}
            }
        }
    });

    // Sunburst chart
    const sunburstData = {{ sunburst_data | tojson }};
    const majors = [...new Set(sunburstData.map(d => d[0]))];
    const labels = majors.concat(sunburstData.map(d => d[1]));
    const parents = Array(majors.length).fill('').concat(sunburstData.map(d => d[0]));
    const values = Array(majors.length).fill(1).concat(sunburstData.map(d => d[2]));
    
    Plotly.newPlot('sunburstChart', [{
        type: 'sunburst',
        labels: labels,
        parents: parents,
        values: values,
        branchvalues: 'total',
        hovertemplate: '<b>%{label}</b><br>Programs: %{value}<extra></extra>',
        maxdepth: 2
    }], {
        title: 'Distribution of Academic Programs by Major and Salary Range',
        font: {size: 12}
    });
</script>

<br><br>
<form action="{{ url_for('logout') }}" method="get" style="display:inline;">
    <button type="submit">Logout</button>
</form>

</body>
</html>
